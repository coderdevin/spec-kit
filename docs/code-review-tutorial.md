# Spec-Kit 代码审查完整教程

> 一个基于 AI 辅助的四步代码审查流程，帮助你快速发现并修复代码问题

## 📋 目录

- [简介](#简介)
- [前置准备](#前置准备)
- [完整流程](#完整流程)
  - [第一步：AI 初步审查](#第一步ai-初步审查)
  - [第二步：人工确认问题](#第二步人工确认问题)
  - [第三步：深度验证与扩展](#第三步深度验证与扩展)
  - [第四步：生成总结报告](#第四步生成总结报告)
- [最佳实践](#最佳实践)
- [常见问题](#常见问题)

---

## 简介

本教程介绍一套高效的代码审查流程，结合多个 AI 模型的优势：
- **Claude-4.5-thinking**：深度分析，发现潜在问题
- **GPT-5-Codex**：精准验证，扩展问题范围
- **Claude-4.5-haiku**：快速总结，节省成本

这个流程适用于 Python、React 和 Java 项目的代码审查。

---

## 前置准备

### 一键安装 Spec-Kit

只需要一条命令，即可完成所有准备工作：

```bash
uvx --from git+https://github.com/coderdevin/spec-kit specify init . --ai cursor --force
```

**命令说明：**
- `uvx`：使用 uv 的包执行工具
- `--from git+https://github.com/coderdevin/spec-kit`：直接从 GitHub 仓库安装
- `specify init .`：在当前目录初始化 spec-kit
- `--ai cursor`：配置为 Cursor IDE 环境
- `--force`：强制覆盖已有配置

安装完成后，你的项目会包含：
- `.specify/` 目录：存放审查报告
- `.cursor/commands/` 目录：包含所有代码审查命令
- 各种代码审查模板

---

## 完整流程

### 第一步：AI 初步审查

使用 **Claude-4.5-thinking** 模型进行深度代码分析。这个模型擅长逻辑推理和问题发现。

#### 操作方法

在 Cursor IDE 中，根据你的项目类型选择相应命令：

**Python 项目：**
```
speckit.codereview-python <目标目录或文件> 中文输出
```

**React 项目：**
```
speckit.codereview-react <目标目录或文件> 中文输出
```

**Java 项目：**
```
speckit.codereview-java <目标目录或文件> 中文输出
```

#### 使用示例

审查 Python 项目的 `src/api` 目录：
```
speckit.codereview-python src/api 中文输出
```

审查单个 React 组件：
```
speckit.codereview-react src/components/UserProfile.tsx 中文输出
```

#### 输出结果

命令执行后会在 `.specify/reviews/` 目录下生成一份详细的审查报告，例如：
```
.specify/reviews/codereview-python-2024-10-29-143052.md
```

报告包含：
- **严重问题**：需要立即修复的问题
- **潜在风险**：可能引发问题的代码
- **改进建议**：优化代码质量的建议
- **任务列表**：可勾选的问题清单

---

### 第二步：人工确认问题

这是整个流程中最关键的一步——**你的专业判断**。

#### 操作步骤

1. **打开报告文件**
   
   在 `.specify/reviews/` 目录中找到刚生成的报告文件，用编辑器打开。

2. **仔细阅读每个问题**
   
   报告中的每个问题都包含：
   - 问题描述
   - 相关代码片段
   - 严重程度
   - 修复建议

3. **标记真正的问题**
   
   报告中包含一个任务列表（Task List），格式如下：
   
   ```markdown
   ## 待确认问题
   
   - [ ] 问题1：缺少输入验证，可能导致注入攻击
   - [ ] 问题2：未处理异常，可能导致程序崩溃
   - [ ] 问题3：变量命名不规范，影响代码可读性
   - [ ] 问题4：循环效率低下，可能影响性能
   ```
   
   **如果你认为某个问题确实存在，就在方括号中打勾：**
   
   ```markdown
   - [x] 问题1：缺少输入验证，可能导致注入攻击
   - [ ] 问题2：未处理异常，可能导致程序崩溃
   - [x] 问题4：循环效率低下，可能影响性能
   ```

4. **保存文件**
   
   完成标记后保存报告文件。

#### 判断技巧

- ✅ **应该打勾**：安全漏洞、逻辑错误、性能问题、违反最佳实践
- ❌ **可以忽略**：风格偏好、过度优化、误报、不适用的建议

---

### 第三步：深度验证与扩展

使用 **GPT-5-Codex** 模型对已确认的问题进行深度验证，并找出代码库中的类似问题。

#### 为什么选择 GPT-5-Codex？

- 对代码理解更精准
- 擅长模式识别，能找出相似问题
- 可以一次性排查整个代码库

#### 操作方法

在 Cursor IDE 中运行：

```
speckit.codereview-check <第二步的报告文件路径>
```

#### 使用示例

```
speckit.codereview-check .specify/reviews/codereview-python-2024-10-29-143052.md
```

#### 输出结果

会在 `.specify/reviews/` 目录下生成验证报告，例如：
```
.specify/reviews/validation-2024-10-29-150230.md
```

报告内容：
- **问题确认结果**：验证每个被标记问题的真实性
- **代码位置**：问题的具体文件和行号
- **相似问题**：在其他文件中发现的类似问题
- **修复优先级**：根据影响程度排序
- **修复建议**：详细的代码修改方案

---

### 第四步：生成总结报告

使用 **Claude-4.5-haiku** 模型整合所有审查结果，生成最终报告。

#### 为什么选择 Claude-4.5-haiku？

- 文本整理能力强
- 成本是 Claude-4.5-thinking 的 1/3
- 对于总结任务完全够用

#### 操作方法

在 Cursor IDE 中运行：

```
speckit.codereview-summary <审查报告> <验证报告>
```

#### 使用示例

```
speckit.codereview-summary \
  .specify/reviews/codereview-python-2024-10-29-143052.md \
  .specify/reviews/validation-2024-10-29-150230.md
```

#### 输出结果

生成最终总结报告：
```
.specify/reviews/summary-2024-10-29-152015.md
```

报告包含：
- **执行摘要**：问题总览和关键发现
- **问题分类**：按严重程度和类型分组
- **影响分析**：问题对项目的潜在影响
- **修复计划**：建议的修复顺序和时间估算
- **学习要点**：团队可以改进的地方

这份报告可以：
- 与团队分享
- 作为修复工作的指导
- 归档到项目文档中

---

## 最佳实践

### 1. 合理划分审查范围

**✅ 推荐做法：**
- 按模块或功能审查
- 单次审查不超过 2000 行代码
- 优先审查核心业务逻辑和安全相关代码

**❌ 避免：**
- 一次性审查整个大型项目
- 审查自动生成的代码
- 审查第三方库代码

### 2. 审查时机选择

- **最佳时机**：
  - Pull Request 提交前
  - 重要功能开发完成后
  - 重构代码后
  - 发现 bug 后排查相关代码

### 3. 人工确认要点

在第二步人工确认时，重点关注：

1. **安全问题**：SQL 注入、XSS、权限绕过等
2. **业务逻辑**：是否符合需求，边界条件处理
3. **性能问题**：明显的性能瓶颈
4. **可维护性**：代码是否容易理解和修改

### 4. 团队协作建议

- **代码作者**：提供上下文说明，解释特殊设计
- **审查者**：保持客观，关注事实而非风格
- **技术负责人**：把控整体质量，决定修复优先级

### 5. 持续改进

- 定期回顾审查报告，总结常见问题
- 将高频问题写入团队编码规范
- 考虑添加自动化检查（linter、静态分析工具）

---

## 常见问题

### Q1: 中文输出参数是必须的吗？

**A:** 不是必须的。如果不加"中文输出"，报告将以英文生成。你可以根据团队偏好选择：

```bash
# 英文报告
speckit.codereview-python src/api

# 中文报告
speckit.codereview-python src/api 中文输出
```

### Q2: 第一步生成的报告太长，怎么办？

**A:** 可以缩小审查范围：
- 审查单个文件而不是整个目录
- 将大型模块拆分为多次审查
- 使用 `.specifyignore` 文件排除不需要审查的文件

### Q3: 如何处理误报？

**A:** 在第二步人工确认时不要打勾即可。AI 并不完美，误报是正常的，你的专业判断是关键。

### Q4: 可以跳过某些步骤吗？

**A:** 理论上可以，但不推荐：
- 跳过第二步：会让第三步验证所有问题（包括误报），浪费时间
- 跳过第三步：可能遗漏其他地方的类似问题
- 跳过第四步：缺少一份结构化的总结报告

### Q5: 这个流程适合小项目吗？

**A:** 适合，但可以简化：
- 小项目可以直接从第一步跳到第四步
- 如果代码量很少（<500行），可以只用第一步

### Q6: 审查报告可以删除吗？

**A:** 可以。`.specify/reviews/` 目录下的报告都是普通 Markdown 文件，你可以：
- 定期清理旧报告
- 将重要报告移动到其他位置归档
- 添加到 `.gitignore` 避免提交到版本控制

### Q7: 支持其他编程语言吗？

**A:** 目前内置支持 Python、React 和 Java。如果需要审查其他语言：
- 可以使用 Python 命令作为通用审查工具
- 考虑贡献新的语言支持到项目中

### Q8: 审查过程中可以中断吗？

**A:** 可以。每一步都会保存结果文件，你可以：
- 随时暂停，稍后继续
- 从任何步骤重新开始
- 对同一份代码进行多次审查

---

## 总结

通过这个四步流程，你可以：

1. ✅ **快速发现问题**：AI 在几分钟内完成初步审查
2. ✅ **避免误报**：人工确认保证问题的准确性
3. ✅ **全面排查**：自动找出代码库中的类似问题
4. ✅ **节省成本**：使用合适的模型，优化审查成本
5. ✅ **提升质量**：系统化的流程保证代码质量

现在就开始你的第一次代码审查吧！

```bash
# 1. 安装 spec-kit
uvx --from git+https://github.com/coderdevin/spec-kit specify init . --ai cursor --force

# 2. 开始审查
speckit.codereview-python src/ 中文输出
```

---

## 相关资源

- [Spec-Kit GitHub 仓库](https://github.com/coderdevin/spec-kit)
- [Spec-Driven Development 方法论](../spec-driven.md)
- [更多文档](./README.md)

---

**祝你代码审查愉快！** 🎉

